{"ast":null,"code":"var _jsxFileName = \"/Applications/MAMP/htdocs/e-complain-box/packages/frontend/src/contexts/AuthContext.js\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport React, { useContext, useState, useEffect } from \"react\";\nimport { auth } from \"../firebase\";\nimport axios from 'axios';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst client = axios.create({\n  baseURL: 'http://localhost:3030',\n  json: true\n});\nconst AuthContext = /*#__PURE__*/React.createContext();\nexport function useAuth() {\n  _s();\n\n  return useContext(AuthContext);\n}\n\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nexport function AuthProvider(_ref) {\n  _s2();\n\n  let {\n    children\n  } = _ref;\n  const [currentUser, setCurrentUser] = useState();\n  const [loading, setLoading] = useState(true);\n\n  function signup(email, password, phone, fullname, callback) {\n    return auth.createUserWithEmailAndPassword(email, password).then(function (user) {\n      var user = auth.currentUser;\n      let data = {\n        fullname: fullname,\n        email: email,\n        password: password,\n        mobile: phone\n      };\n      auth.currentUser.getIdToken(true).then(idToken => {\n        client({\n          method: 'post',\n          url: '/registration',\n          headers: {\n            'AuthToken': idToken\n          },\n          data: data\n        }).then(res => {\n          console.log(res);\n          callback(\"success\"); //return \"success\";\n          //this.response = res.data.message\n        }).catch(error => {\n          this.response = error;\n        });\n      }).catch(error => {\n        callback(\"fail\");\n        this.response = \"Error getting auth token\";\n      });\n    }, function (error) {\n      console.log(error);\n      callback(\"fail\"); //return \"fail\";\n    });\n  }\n\n  function login(email, password, callback) {\n    const phoneRegex = /^(\\+91-|\\+91|0)?\\d{10}$/; // Change this regex based on requirement\n\n    let isValidPhone = phoneRegex.test(email); //\n\n    let idToken = \"eyJhbGciOiJSUzI1NiIsImtpZCI6IjhmYmRmMjQxZTdjM2E2NTEzNTYwNmRkYzFmZWQyYzU1MjI2MzBhODciLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vZmlyc3QtcHJvamVjdC0yOWRkMSIsImF1ZCI6ImZpcnN0LXByb2plY3QtMjlkZDEiLCJhdXRoX3RpbWUiOjE2MzQ5MjQzMDUsInVzZXJfaWQiOiJScXJhMGd0aEk0UmlnY3lxRVZHZEowYnd0VkYzIiwic3ViIjoiUnFyYTBndGhJNFJpZ2N5cUVWR2RKMGJ3dFZGMyIsImlhdCI6MTYzNDkyNTE0MCwiZXhwIjoxNjM0OTI4NzQwLCJlbWFpbCI6InJhbWFuYXNhbmthcnZAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJmaXJlYmFzZSI6eyJpZGVudGl0aWVzIjp7ImVtYWlsIjpbInJhbWFuYXNhbmthcnZAZ21haWwuY29tIl19LCJzaWduX2luX3Byb3ZpZGVyIjoicGFzc3dvcmQifX0.bvChf2MvgobFjw5SL0dSpNGcFyVhFQcEQLU83m1axsk_k_bgpoI8dCA8I_PvCujihltXWXeNpnRJXxUffsk_51o8o06y9GVzrduL1-nOvuNNFFvv7XEJK1RFol746EU2Pk6tJVnSL2ZOxFqAQONxw6kpHNj3xdcskK1s3iv7kHroBbs15F0M_y_19_yGS0cVzkO31HCRUhbF43cwyiw6gQV3XAlwhQjPfcYOzDZQq5jwSy08_OFgLLcdqp9UT4t4bq-zthUkWa6WFCo57vqZLYjVEdQsipl4FFhkcYfWW8sJlHxBzby83ZRf10uktJg3mZRi0hnJZmSy3y10Qz0SJw\";\n    console.log(isValidPhone);\n    console.log(\"ramana\");\n\n    if (isValidPhone) {\n      let data = {\n        mobile: email\n      };\n      client({\n        method: 'post',\n        url: '/getemailbymobile',\n        headers: {\n          'AuthToken': idToken\n        },\n        data: data\n      }).then(res => {\n        console.log(res.data.userEmail);\n        email = res.data.userEmail;\n        auth.signInWithEmailAndPassword(email, password).then(function (user) {\n          callback(\"success\");\n        }, function (error) {\n          console.log(error);\n          callback(\"fail\");\n        });\n      }).catch(error => {\n        callback(\"fail\");\n      });\n    } else auth.signInWithEmailAndPassword(email, password).then(function (user) {\n      callback(\"success\");\n    }, function (error) {\n      console.log(error);\n      callback(\"fail\");\n    });\n  }\n\n  function logout() {\n    return auth.signOut();\n  }\n\n  function resetPassword(email) {\n    return auth.sendPasswordResetEmail(email);\n  }\n\n  function updateEmail(email) {\n    return currentUser.updateEmail(email);\n  }\n\n  function updatePassword(password) {\n    return currentUser.updatePassword(password);\n  }\n\n  useEffect(() => {\n    const unsubscribe = auth.onAuthStateChanged(user => {\n      setCurrentUser(user);\n      setLoading(false);\n    });\n    return unsubscribe;\n  }, []);\n  const value = {\n    currentUser,\n    login,\n    signup,\n    logout,\n    resetPassword,\n    updateEmail,\n    updatePassword\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: value,\n    children: !loading && children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 137,\n    columnNumber: 5\n  }, this);\n}\n\n_s2(AuthProvider, \"1cdeWWSmbSz3cOWqWLAt+Ta4DMY=\");\n\n_c = AuthProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["/Applications/MAMP/htdocs/e-complain-box/packages/frontend/src/contexts/AuthContext.js"],"names":["React","useContext","useState","useEffect","auth","axios","client","create","baseURL","json","AuthContext","createContext","useAuth","AuthProvider","children","currentUser","setCurrentUser","loading","setLoading","signup","email","password","phone","fullname","callback","createUserWithEmailAndPassword","then","user","data","mobile","getIdToken","idToken","method","url","headers","res","console","log","catch","error","response","login","phoneRegex","isValidPhone","test","userEmail","signInWithEmailAndPassword","logout","signOut","resetPassword","sendPasswordResetEmail","updateEmail","updatePassword","unsubscribe","onAuthStateChanged","value"],"mappings":"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","sourcesContent":["import React, { useContext, useState, useEffect } from \"react\"\nimport { auth } from \"../firebase\"\nimport axios from 'axios'\n\nconst client = axios.create({\n  baseURL: 'http://localhost:3030',\n  json: true\n})\n\n\nconst AuthContext = React.createContext()\n\nexport function useAuth() {\n  return useContext(AuthContext)\n}\n\nexport function AuthProvider({ children }) {\n  const [currentUser, setCurrentUser] = useState()\n  const [loading, setLoading] = useState(true)\n\n  \n\n  function signup(email, password,phone,fullname,callback) {\n    return auth.createUserWithEmailAndPassword(email, password).then(function(user) {\n      var user = auth.currentUser;\n      let data={\n        fullname:fullname,\n        email:email,\n        password:password,\n        mobile:phone\n      }\n      auth.currentUser.getIdToken(true).then((idToken) => {\n        client({\n          method: 'post',\n          url: '/registration',\n          headers: {\n            'AuthToken': idToken\n          },\n          data: data\n        }).then((res) => {\n          console.log(res);\n          callback(\"success\");\n          //return \"success\";\n          //this.response = res.data.message\n        }).catch((error) => {\n          this.response = error\n        })\n      }).catch((error) => {\n        callback(\"fail\");\n        this.response = \"Error getting auth token\"\n      });\n       \n    }, function(error) {\n      console.log(error);\n      callback(\"fail\");\n      //return \"fail\";\n    });\n  }\n\n  function login(email, password,callback) {\n    const phoneRegex = /^(\\+91-|\\+91|0)?\\d{10}$/; // Change this regex based on requirement\n    let isValidPhone = phoneRegex.test(email); //\n    let idToken=\"eyJhbGciOiJSUzI1NiIsImtpZCI6IjhmYmRmMjQxZTdjM2E2NTEzNTYwNmRkYzFmZWQyYzU1MjI2MzBhODciLCJ0eXAiOiJKV1QifQ.eyJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vZmlyc3QtcHJvamVjdC0yOWRkMSIsImF1ZCI6ImZpcnN0LXByb2plY3QtMjlkZDEiLCJhdXRoX3RpbWUiOjE2MzQ5MjQzMDUsInVzZXJfaWQiOiJScXJhMGd0aEk0UmlnY3lxRVZHZEowYnd0VkYzIiwic3ViIjoiUnFyYTBndGhJNFJpZ2N5cUVWR2RKMGJ3dFZGMyIsImlhdCI6MTYzNDkyNTE0MCwiZXhwIjoxNjM0OTI4NzQwLCJlbWFpbCI6InJhbWFuYXNhbmthcnZAZ21haWwuY29tIiwiZW1haWxfdmVyaWZpZWQiOmZhbHNlLCJmaXJlYmFzZSI6eyJpZGVudGl0aWVzIjp7ImVtYWlsIjpbInJhbWFuYXNhbmthcnZAZ21haWwuY29tIl19LCJzaWduX2luX3Byb3ZpZGVyIjoicGFzc3dvcmQifX0.bvChf2MvgobFjw5SL0dSpNGcFyVhFQcEQLU83m1axsk_k_bgpoI8dCA8I_PvCujihltXWXeNpnRJXxUffsk_51o8o06y9GVzrduL1-nOvuNNFFvv7XEJK1RFol746EU2Pk6tJVnSL2ZOxFqAQONxw6kpHNj3xdcskK1s3iv7kHroBbs15F0M_y_19_yGS0cVzkO31HCRUhbF43cwyiw6gQV3XAlwhQjPfcYOzDZQq5jwSy08_OFgLLcdqp9UT4t4bq-zthUkWa6WFCo57vqZLYjVEdQsipl4FFhkcYfWW8sJlHxBzby83ZRf10uktJg3mZRi0hnJZmSy3y10Qz0SJw\";\n    console.log(isValidPhone);\n    console.log(\"ramana\")\n    if(isValidPhone){\n      let data={\n        mobile:email\n      }\n      client({\n        method: 'post',\n        url: '/getemailbymobile',\n        headers: {\n          'AuthToken': idToken\n        },\n        data: data\n      }).then((res) => {\n        console.log(res.data.userEmail);\n        email = res.data.userEmail\n        auth.signInWithEmailAndPassword(email, password).then(function(user) {\n          callback(\"success\");\n        },\n        function(error) {\n          console.log(error);\n          callback(\"fail\");\n        });\n      }).catch((error) => {\n        callback(\"fail\");\n      })\n    } \n    else\n      auth.signInWithEmailAndPassword(email, password).then(function(user) {\n        callback(\"success\");\n      },\n      function(error) {\n        console.log(error);\n        callback(\"fail\");\n      });\n  }\n\n  function logout() {\n    return auth.signOut()\n  }\n\n  function resetPassword(email) {\n    return auth.sendPasswordResetEmail(email)\n  }\n\n  function updateEmail(email) {\n    return currentUser.updateEmail(email)\n  }\n\n  function updatePassword(password) {\n    return currentUser.updatePassword(password)\n  }\n\n  useEffect(() => {\n    const unsubscribe = auth.onAuthStateChanged(user => {\n      setCurrentUser(user)\n      setLoading(false)\n    })\n\n    return unsubscribe\n  }, [])\n\n  const value = {\n    currentUser,\n    login,\n    signup,\n    logout,\n    resetPassword,\n    updateEmail,\n    updatePassword\n  }\n\n  return (\n    <AuthContext.Provider value={value}>\n      {!loading && children}\n    </AuthContext.Provider>\n  )\n}\n"]},"metadata":{},"sourceType":"module"}